<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GauntletAI Challenger Profile</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --text-color: #333;
            --light-gray: #f5f7fa;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            --transition-speed: 0.3s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }

        .nav-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .nav-links a {
            margin-left: 15px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color var(--transition-speed);
        }

        .nav-links a:hover {
            color: var(--secondary-color);
        }

        .profile-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .profile-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            color: var(--primary-color);
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 5px;
            background: var(--light-gray);
            transition: background var(--transition-speed);
        }

        .social-links a:hover {
            background: #e0e6ed;
        }

        .profile-main {
            display: grid;
            grid-template-columns: 1fr 2fr;
            padding: 0;
        }

        .profile-left {
            padding: 20px;
            border-right: 1px solid #eee;
        }

        .profile-pic-container {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 20px;
            border: 3px solid var(--primary-color);
        }

        .profile-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .profile-title {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .left-section-container {
            margin-top: 30px;
        }

        .left-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            text-align: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .left-skills-list {
            list-style-type: none;
            margin-bottom: 25px;
        }

        .left-skill-item {
            padding: 8px 0;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .left-skill-item:last-child {
            border-bottom: none;
        }

        .left-skill-icon {
            color: var(--secondary-color);
            margin-right: 10px;
            font-size: 1rem;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #f0f8ff;
        }

        .left-skill-text {
            font-size: 1rem;
        }

        .left-tags-container {
            margin-top: 10px;
        }

        .left-tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .left-tag {
            background: var(--light-gray);
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .profile-right {
            padding: 20px;
        }

        .metadata-section {
            margin-bottom: 25px;
        }

        .about-qr-container {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .about-section {
            flex: 1;
        }

        .qr-container {
            display: flex;
            gap: 10px;
        }

        .qr-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .qr-code {
            width: 120px;
            height: 120px;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        .qr-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }

        .metadata-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .metadata-content {
            font-size: 1rem;
            color: #555;
        }

        .social-profiles {
            margin-top: 20px;
        }

        .profile-switcher {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .profile-toggle-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color var(--transition-speed);
        }

        .profile-toggle-btn:hover {
            background-color: #2980b9;
        }

        .github-container,
        .linkedin-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .qr-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }

        .github-stats,
        .github-langs,
        .github-contrib-chart {
            width: 100%;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .contrib-section h3 {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 10px;
        }

        @media (max-width: 992px) {
            .about-qr-container {
                flex-direction: column;
            }

            .qr-container {
                justify-content: flex-start;
            }
        }

        @media (max-width: 768px) {
            .profile-main {
                grid-template-columns: 1fr;
            }

            .profile-left {
                border-right: none;
                border-bottom: 1px solid #eee;
            }

            .profile-header {
                justify-content: center;
            }

            .qr-container {
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="nav-bar">
            <div class="nav-title">GauntletAI Challengers</div>
            <div class="nav-links">
                <a href="/pages">All Challengers</a>
                <a href="https://www.gauntletai.com" target="_blank">About GauntletAI</a>
            </div>
        </div>

        <div id="profile-card" class="profile-card">
            <div class="profile-header">
                <div class="social-links" id="social-links">
                    <!-- Social links will be dynamically added here -->
                </div>
            </div>

            <div class="profile-main">
                <div class="profile-left">
                    <div class="profile-pic-container">
                        <img id="profile-pic" src="https://randomuser.me/api/portraits/lego/1.jpg" alt="Profile picture"
                            class="profile-pic">
                    </div>
                    <h2 id="profile-name" class="profile-name">Loading...</h2>
                    <div id="profile-title" class="profile-title">Loading...</div>

                    <div class="left-section-container">
                        <h3 class="left-section-title">Skills</h3>
                        <ul id="skills-list" class="left-skills-list">
                            <!-- Skills will be dynamically added here -->
                        </ul>
                    </div>

                    <div class="left-section-container">
                        <h3 class="left-section-title">Project Tags</h3>
                        <div id="tags-list" class="left-tags-list">
                            <!-- Project tags will be dynamically added here -->
                        </div>
                    </div>
                </div>

                <div class="profile-right">
                    <!-- About section and QR codes side by side -->
                    <div class="about-qr-container">
                        <div class="about-section">
                            <h3 class="metadata-title">About</h3>
                            <p id="bio-content" class="metadata-content">Loading challenger information...</p>
                        </div>

                        <div class="qr-container">
                            <div class="qr-item" id="github-qr-container">
                                <img id="github-qr" src="" alt="GitHub QR" class="qr-code">
                                <div class="qr-label">GitHub</div>
                            </div>
                            <div class="qr-item" id="linkedin-qr-container">
                                <img id="linkedin-qr" src="" alt="LinkedIn QR" class="qr-code">
                                <div class="qr-label">LinkedIn</div>
                            </div>
                        </div>
                    </div>

                    <!-- Projects section -->
                    <div class="projects-section">
                        <h3 class="section-title">Projects</h3>
                        <div id="projects-container" class="projects-container">
                            <div class="loading-indicator">
                                <div class="loading-spinner"></div>
                                <p>Loading projects...</p>
                            </div>
                            <!-- Projects will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Social integration section (GitHub or LinkedIn)  -->
                    <div class="social-profiles">
                        <div class="github-container" id="github-container">
                            <div class="profile-section">
                                <h3>GitHub Stats</h3>
                                <div id="github-stats-container" class="github-stats-container">
                                    <!-- GitHub stats will be dynamically added here if GitHub username is available -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Endpoints
        const API_BASE_URL = '/api';
        const API_PROFILES = `${API_BASE_URL}/profiles`;
        const API_PROJECTS = `${API_BASE_URL}/projects`;

        // Get profile ID from URL
        function getProfileIdFromUrl() {
            // Extract challenger ID from URL path - format: /pages/challenger/ID
            const pathParts = window.location.pathname.split('/');
            // The ID should be the last part of the URL
            return pathParts[pathParts.length - 1];
        }

        // Fetch profile data
        async function fetchProfileData(profileId) {
            try {
                const response = await fetch(`${API_PROFILES}/${profileId}`);
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                const result = await response.json();

                if (result.success && result.data) {
                    return result.data;
                } else {
                    throw new Error('Invalid data format received from API');
                }
            } catch (error) {
                console.error('Error fetching profile:', error);
                return null;
            }
        }

        // Fetch projects for a profile
        async function fetchProfileProjects(profileId) {
            try {
                const response = await fetch(`${API_PROFILES}/${profileId}/projects`);
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                const result = await response.json();

                if (result.success && Array.isArray(result.data)) {
                    return result.data;
                } else {
                    throw new Error('Invalid data format received from API');
                }
            } catch (error) {
                console.error('Error fetching projects:', error);
                return [];
            }
        }

        // Utility function to extract username from URL
        function extractUsernameFromUrl(url) {
            if (!url) return null;

            try {
                const urlObj = new URL(url);

                // GitHub URL format: https://github.com/username
                if (urlObj.hostname === 'github.com') {
                    const path = urlObj.pathname.split('/').filter(Boolean);
                    return path.length > 0 ? path[0] : null;
                }

                // LinkedIn URL format: https://linkedin.com/in/username
                if (urlObj.hostname === 'linkedin.com' || urlObj.hostname === 'www.linkedin.com') {
                    const path = urlObj.pathname.split('/').filter(Boolean);
                    return path.length > 1 && path[0] === 'in' ? path[1] : null;
                }

                return null;
            } catch (error) {
                console.error('Error extracting username:', error);
                return null;
            }
        }

        // Populate profile data in the UI
        function populateProfileData(profile) {
            if (!profile) {
                document.title = 'Profile Not Found - GauntletAI Challengers';
                document.getElementById('profile-name').textContent = 'Profile Not Found';
                document.getElementById('profile-title').textContent = 'The requested profile could not be found';
                document.getElementById('bio-content').textContent = 'Please go back to the challengers list and select a valid profile.';
                return;
            }

            // Update page title
            document.title = `${profile.name} - GauntletAI Challenger`;

            // Update profile picture
            const profilePic = document.getElementById('profile-pic');
            if (profile.pic_url) {
                profilePic.src = profile.pic_url;
                profilePic.alt = profile.name;
            }

            // Update profile name and title
            document.getElementById('profile-name').textContent = profile.name;
            document.getElementById('profile-title').textContent = profile.blurb || 'GauntletAI Challenger';

            // Update bio content
            document.getElementById('bio-content').textContent = profile.bio || 'No bio available';

            // Populate skills list
            const skillsList = document.getElementById('skills-list');
            skillsList.innerHTML = '';

            if (profile.skills && profile.skills.length > 0) {
                profile.skills.forEach(skill => {
                    const listItem = document.createElement('li');
                    listItem.className = 'left-skill-item';

                    listItem.innerHTML = `
                        <span class="left-skill-icon">•</span>
                        <span class="left-skill-text">${skill}</span>
                    `;

                    skillsList.appendChild(listItem);
                });
            } else {
                const listItem = document.createElement('li');
                listItem.className = 'left-skill-item';
                listItem.innerHTML = '<span class="left-skill-text">No skills listed</span>';
                skillsList.appendChild(listItem);
            }

            // Populate social links
            const socialLinks = document.getElementById('social-links');
            socialLinks.innerHTML = '';

            if (profile.github_url) {
                const githubLink = document.createElement('a');
                githubLink.href = profile.github_url;
                githubLink.target = '_blank';
                githubLink.textContent = 'GitHub';
                socialLinks.appendChild(githubLink);

                // Generate GitHub QR code
                const githubQr = document.getElementById('github-qr');
                githubQr.src = `https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(profile.github_url)}`;

                // Try to set up GitHub stats
                const githubUsername = extractUsernameFromUrl(profile.github_url);
                if (githubUsername) {
                    const githubStatsContainer = document.getElementById('github-stats-container');
                    githubStatsContainer.innerHTML = `
                        <iframe
                            src="https://github-readme-stats.vercel.app/api?username=${githubUsername}&show_icons=true&theme=default"
                            frameborder="0"
                            scrolling="no"
                            width="100%"
                            height="200"
                            class="github-stats">
                        </iframe>
                        <div class="contrib-section">
                            <h4>Contribution Activity</h4>
                            <img 
                                src="https://ghchart.rshah.org/${githubUsername}" 
                                alt="GitHub Contribution Graph" 
                                class="github-contrib-chart">
                        </div>
                    `;
                }
            } else {
                document.getElementById('github-qr-container').style.display = 'none';
            }

            if (profile.linkedin_url) {
                const linkedinLink = document.createElement('a');
                linkedinLink.href = profile.linkedin_url;
                linkedinLink.target = '_blank';
                linkedinLink.textContent = 'LinkedIn';
                socialLinks.appendChild(linkedinLink);

                // Generate LinkedIn QR code
                const linkedinQr = document.getElementById('linkedin-qr');
                linkedinQr.src = `https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(profile.linkedin_url)}`;
            } else {
                document.getElementById('linkedin-qr-container').style.display = 'none';
            }

            if (profile.twitter_url || profile.gauntlet_url) {
                if (profile.twitter_url) {
                    const twitterLink = document.createElement('a');
                    twitterLink.href = profile.twitter_url;
                    twitterLink.target = '_blank';
                    twitterLink.textContent = 'Twitter';
                    socialLinks.appendChild(twitterLink);
                }

                if (profile.gauntlet_url) {
                    const gauntletLink = document.createElement('a');
                    gauntletLink.href = profile.gauntlet_url;
                    gauntletLink.target = '_blank';
                    gauntletLink.textContent = 'GauntletAI';
                    socialLinks.appendChild(gauntletLink);
                }
            }

            // Update social links
            if (profile.github_url) {
                const githubLink = document.getElementById('github-link');
                githubLink.href = profile.github_url;
                githubLink.style.display = 'inline-flex';
            } else {
                document.getElementById('github-link').style.display = 'none';
            }

            if (profile.linkedin_url) {
                const linkedinLink = document.getElementById('linkedin-link');
                linkedinLink.href = profile.linkedin_url;
                linkedinLink.style.display = 'inline-flex';
            } else {
                document.getElementById('linkedin-link').style.display = 'none';
            }

            // Set up projects link
            const projectsLink = document.getElementById('projects-link');
            projectsLink.href = `/pages/challenger/${profile.id}/projects`;
        }

        // Create project card
        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';

            // Create tags list HTML
            let techsHtml = '';
            if (project.techs && project.techs.length > 0) {
                techsHtml = project.techs.map(tech => `<span class="project-tag">${tech}</span>`).join('');
            }

            // Create links HTML
            let linksHtml = '';
            if (project.github_url) {
                linksHtml += `<a href="${project.github_url}" target="_blank" class="project-link github-link">GitHub</a>`;
            }
            if (project.deploy_url) {
                linksHtml += `<a href="${project.deploy_url}" target="_blank" class="project-link demo-link">Live Demo</a>`;
            }

            card.innerHTML = `
                <div class="project-header">
                    <h3 class="project-title">${project.title}</h3>
                    <div class="project-techs">${techsHtml}</div>
                </div>
                
                ${project.screenshot_url ?
                    `<div class="project-screenshot">
                        <img src="${project.screenshot_url}" alt="${project.title} screenshot" loading="lazy">
                    </div>` : ''}
                
                <div class="project-description">${project.description}</div>
                
                ${linksHtml ? `<div class="project-links">${linksHtml}</div>` : ''}
                
                ${project.video_url ?
                    `<div class="project-video">
                        <iframe src="${project.video_url}" frameborder="0" allowfullscreen></iframe>
                    </div>` : ''}
            `;

            return card;
        }

        // Populate projects data
        function populateProjectsData(projects, profile) {
            const projectsContainer = document.getElementById('projects-container');
            projectsContainer.innerHTML = '';

            // Create unified list of all technologies for the tags section
            const allTechs = new Set();

            if (projects.length === 0) {
                const noProjects = document.createElement('div');
                noProjects.className = 'no-projects-message';
                noProjects.textContent = 'No projects available for this challenger.';
                projectsContainer.appendChild(noProjects);
            } else {
                // Append project cards
                projects.forEach(project => {
                    // Add project techs to the unified list
                    if (project.techs && Array.isArray(project.techs)) {
                        project.techs.forEach(tech => allTechs.add(tech));
                    }

                    const card = createProjectCard(project);
                    projectsContainer.appendChild(card);
                });
            }

            // Populate tags list with all unique technologies
            const tagsList = document.getElementById('tags-list');
            tagsList.innerHTML = '';

            if (allTechs.size > 0) {
                Array.from(allTechs).forEach(tech => {
                    const tag = document.createElement('span');
                    tag.className = 'left-tag';
                    tag.textContent = tech;
                    tagsList.appendChild(tag);
                });
            } else {
                const noTags = document.createElement('span');
                noTags.className = 'left-tag muted';
                noTags.textContent = 'No tags available';
                tagsList.appendChild(noTags);
            }
        }

        // Initialize the page
        async function initializePage() {
            // Get profile ID from URL
            const profileId = getProfileIdFromUrl();

            if (!profileId) {
                // Handle missing profile ID
                document.getElementById('profile-name').textContent = 'Profile Not Found';
                document.getElementById('profile-title').textContent = 'No profile ID provided';
                document.getElementById('bio-content').textContent = 'Please go back to the challengers list and select a profile.';
                return;
            }

            // Fetch profile data
            const profile = await fetchProfileData(profileId);

            // Populate profile information
            populateProfileData(profile);

            // Fetch projects for the profile
            const projects = await fetchProfileProjects(profileId);

            // Populate projects information
            populateProjectsData(projects, profile);
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>